_ = require('lodash')

module.exports = (Restangular, MembershipModel) ->

  all: (groupId) ->
    Restangular.one('groups', groupId)
    .all('memberships').getList()
    .then (memberships) ->
      _.map memberships, (membership) ->
        new MembershipModel(membership.plain())

  create: (membership) ->
    Restangular.all('memberships').post(membership)

  update: (membership) ->
    Restangular.one('memberships', membership.id)
    .customPUT(membership, '',
      {membership: membership},
      {Accept: "application/json"})

  remove: (membership) ->
    Restangular.one('memberships', membership.id)
    .customDELETE('', '', {},
      {Accept: "application/json"})

  save: (membership) ->
    if membership.id
      @update(membership)
    else
      @create(membership)
