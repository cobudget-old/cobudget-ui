_ = require('lodash')

module.exports = ($scope, $modalInstance, BucketsStore, group, round, memberships) ->

  $scope.members = _.map memberships, (m) -> m.user

  $scope.submit = (newBucketForm) ->
    $scope.submitted = true

    if newBucketForm.$invalid
      return

    newBucket = {
      name: $scope.name
      description: $scope.description
      user_id: $scope.sponsor.id
      target_cents: $scope.target * 100
      round_id: round.id
    }

    # TODO error handling
    BucketsStore.create(newBucket)
    .then (createdBucket) ->
      $modalInstance.close(createdBucket)

  $scope.cancel = ->
    $modalInstance.dismiss('cancel')
