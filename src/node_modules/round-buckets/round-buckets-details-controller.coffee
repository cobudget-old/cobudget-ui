_ = require('lodash')

### @ngInject ###
module.exports = ($scope, $modal, BucketsStore, AuthService, group, round, bucket) ->

  setBucket = (bucket) ->
    roundBucket = _.find(
      round.buckets,
      (b) ->
        b.id == bucket.id
    )
    roundBucket.name = bucket.name
    roundBucket.description = bucket.description
    roundBucket.user = bucket.user
    roundBucket.target = bucket.target
    $scope.bucket = roundBucket
  
  setBucket(bucket)

  isAdmin = group.isAdmin(AuthService.getCurrentUser())
  $scope.canEdit = isAdmin

  $scope.openEditBucketModal = ->
    $modal.open(
      require('bucket-modal')(
        round: round
        group: group
        bucket: $scope.bucket
      )
    ).result.then (bucket) ->
      setBucket(bucket)

