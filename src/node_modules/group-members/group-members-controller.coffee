_ = require('lodash')

module.exports = ($scope, group, users, memberships, MembershipModel, MembershipsStore) ->
  group.memberships = memberships
  $scope.users = users
  $scope.group = group
  $scope.selectedUser = null

  $scope.addMember = ->
    membership = new MembershipModel({
      user: $scope.selectedUser
      group_id: $scope.group.id
    })
    membership.save(MembershipsStore).then ->
      index = _.sortedIndex memberships, membership, (m) -> m.user.name
      memberships.splice(index, 0, membership)

  $scope.removeMember = (membership, index) ->
    MembershipsStore.remove(membership).then ->
      memberships.splice(index, 1)
