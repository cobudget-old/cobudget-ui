module.exports = ($scope, group, users, memberships, MembershipModel, MembershipsStore) ->
  group.memberships = memberships
  $scope.users = users
  $scope.group = group
  $scope.selectedUser = null

  $scope.addMember = ->
    membership = new MembershipModel({
      user_id: $scope.selectedUser.id
      group_id: $scope.group.id
    })
    membership.save(MembershipsStore).then ->
      $scope.populateMembers()

  $scope.removeMember = (membership) ->
    MembershipsStore.remove(membership).then ->
      $scope.populateMembers()

  $scope.populateMembers = ->
    memberships = $scope.group.memberships
    MembershipsStore.all(group.id).then (new_memberships) ->
      memberships.length = 0
      memberships.push.apply(memberships, new_memberships)
