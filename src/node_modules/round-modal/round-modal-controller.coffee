### @ngInject ###
module.exports = ($scope, $modalInstance, RoundsStore, RoundModel, group) ->

  $scope.submit = (newRoundForm) ->
    $scope.submitted = true

    if newRoundForm.$invalid
      return

    newRound = new RoundModel({
      name: $scope.name
      groupId: group.id
      startsAt: $scope.startsAt
      endsAt: $scope.endsAt
    })

    # TODO error handling
    RoundsStore.create(newRound)
    .then (createdRound) ->
      $modalInstance.close(createdRound)

  $scope.cancel = ->
    $modalInstance.dismiss('cancel')

  $scope.openStartsAt = (ev) ->
    ev.preventDefault()
    ev.stopPropagation()

    $scope.openedStartsAt = true

  $scope.openEndsAt = (ev) ->
    ev.preventDefault()
    ev.stopPropagation()

    $scope.openedEndsAt = true
