### @ngInject ###
module.exports = ($scope, $modalInstance, RoundsStore, RoundModel, group, round) ->

  if round
    serialRound = round.serialize()
    $scope.id = serialRound.id
    $scope.name = serialRound.name
    $scope.startsAt = serialRound.startsAt
    $scope.endsAt = serialRound.endsAt

    $scope.title = "Edit Round!"
  else
    $scope.title = "New Round!"

  $scope.submit = (roundForm) ->
    $scope.submitted = true

    if roundForm.$invalid
      return

    unsavedRound = new RoundModel({
      id: $scope.id
      name: $scope.name
      groupId: group.id
      startsAt: $scope.startsAt
      endsAt: $scope.endsAt
    })

    # TODO error handling
    RoundsStore.save(unsavedRound)
    .then (savedRound) ->
      $modalInstance.close(savedRound)

  $scope.cancel = ->
    $modalInstance.dismiss('cancel')

  $scope.openStartsAt = (ev) ->
    ev.preventDefault()
    ev.stopPropagation()

    $scope.openedStartsAt = true

  $scope.openEndsAt = (ev) ->
    ev.preventDefault()
    ev.stopPropagation()

    $scope.openedEndsAt = true
